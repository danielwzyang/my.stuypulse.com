---
import Layout from "../components/Layout.astro"
import Form from "../components/Form.astro"
---

<Layout title="Signup" desc="Signup to MyPulse">
    <Form type="signup" />

    <script>
        // gets the form element
        const form = document.getElementById("form")

        form?.addEventListener("submit", async (event) => {
            // prevent default stops the default functionality so we can handle it ourselves
            event.preventDefault()

            const data = new FormData(form as HTMLFormElement)

            const response = await fetch("/api/auth/signup", {
                method: "POST",
                body: data,
            })

            // if there are no errors and sign up is successful
            if (response.ok) window.location.href = "/"
            else {
                // gets the error msg from the response
                const text = await response.text()

                // gets the error element and sets the text
                const error = document.getElementById("error")
                error!.textContent = text
            }
        })
    </script>
</Layout>
